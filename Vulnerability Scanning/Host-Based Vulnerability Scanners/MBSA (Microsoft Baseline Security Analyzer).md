Microsoft Baseline Security Analyzer (MBSA) was a free tool from Microsoft used to scan Windows systems for missing security updates, weak passwords, and other common security issues. Though it is no longer supported, some organizations still use it for legacy systems. Below is an overview of how to use MBSA with its options and examples for running scans via the command line.

### **MBSA CLI Commands and Options**

#### **1. Basic MBSA Scan**

1. **Run a Basic Security Scan:**
   - **Description:** This command runs a security scan on the local computer.
   - **Command:**
     ```cmd
     mbsacli /n OS+IIS+SQL+PASSWORD
     ```
   - **Example:**
     ```cmd
     mbsacli /n OS+IIS+SQL+PASSWORD
     ```

   - **Explanation:** 
     - `/n` specifies which tests to run. Here it runs tests for OS (Operating System), IIS (Internet Information Services), SQL (SQL Server), and PASSWORD (password checks).

#### **2. Scan Remote Machines**

1. **Scan a Remote Computer:**
   - **Description:** Scan a specific remote machine by providing the IP address or computer name.
   - **Command:**
     ```cmd
     mbsacli /c IP_or_ComputerName
     ```
   - **Example:**
     ```cmd
     mbsacli /c 192.168.1.100
     ```

   - **Explanation:** 
     - `/c` specifies the remote computer to scan.

2. **Scan Multiple Remote Computers:**
   - **Description:** Scan multiple remote computers by specifying the names in a text file.
   - **Command:**
     ```cmd
     mbsacli /r ComputerList.txt
     ```
   - **Example:**
     ```cmd
     mbsacli /r C:\scans\computers.txt
     ```

   - **Explanation:** 
     - `/r` loads the list of computers from a text file for scanning multiple machines.

#### **3. Customizing Scan Results**

1. **Export Scan Results to XML:**
   - **Description:** Export the results of the scan in XML format for further analysis.
   - **Command:**
     ```cmd
     mbsacli /n OS+IIS+SQL+PASSWORD /xmlout
     ```
   - **Example:**
     ```cmd
     mbsacli /n OS+IIS+SQL+PASSWORD /xmlout > results.xml
     ```

   - **Explanation:** 
     - `/xmlout` saves the scan results in XML format, useful for integrating with other tools.

2. **Specify Output Directory for Scan Results:**
   - **Description:** Specify the directory where the results should be saved.
   - **Command:**
     ```cmd
     mbsacli /n OS+IIS+SQL+PASSWORD /o C:\ScanResults
     ```
   - **Example:**
     ```cmd
     mbsacli /n OS+IIS+SQL+PASSWORD /o C:\Reports
     ```

   - **Explanation:** 
     - `/o` specifies the output directory for storing scan results.

#### **4. Password and Security Update Checks**

1. **Run a Password Vulnerability Check:**
   - **Description:** Check for weak passwords on the system.
   - **Command:**
     ```cmd
     mbsacli /n PASSWORD
     ```
   - **Example:**
     ```cmd
     mbsacli /n PASSWORD
     ```

   - **Explanation:** 
     - This checks for weak or missing passwords on the system.

2. **Scan for Missing Security Updates:**
   - **Description:** Run a scan to check for missing security patches on the system.
   - **Command:**
     ```cmd
     mbsacli /n OS /sus
     ```
   - **Example:**
     ```cmd
     mbsacli /n OS /sus
     ```

   - **Explanation:** 
     - `/sus` specifies a security update scan to check for missing patches.

#### **5. Advanced MBSA Scanning Options**

1. **Scan for Specific Issues (By Customizing Checks):**
   - **Description:** Specify which checks to run (e.g., IIS, SQL, etc.).
   - **Command:**
     ```cmd
     mbsacli /n OS+IIS+SQL
     ```
   - **Example:**
     ```cmd
     mbsacli /n OS+IIS
     ```

   - **Explanation:** 
     - This command will scan only for Operating System and IIS-related vulnerabilities.

2. **Disable Certain Checks (Exclude IIS, SQL, etc.):**
   - **Description:** Run a scan excluding certain checks.
   - **Command:**
     ```cmd
     mbsacli /n OS-PASSWORD
     ```
   - **Example:**
     ```cmd
     mbsacli /n OS-PASSWORD
     ```

   - **Explanation:** 
     - The `-` sign excludes specific checks (in this case, excluding password checks).

3. **Include SUS (Software Update Services) Server for Patching:**
   - **Description:** Direct MBSA to use a local SUS server instead of scanning against Microsoft's online servers.
   - **Command:**
     ```cmd
     mbsacli /sus /c IP_or_ComputerName
     ```
   - **Example:**
     ```cmd
     mbsacli /sus /c 192.168.1.100
     ```

   - **Explanation:** 
     - `/sus` points to a local Software Update Services server for update checks.

#### **6. Additional Options**

1. **Display Help Information:**
   - **Description:** Show a list of all MBSA command-line options.
   - **Command:**
     ```cmd
     mbsacli /?
     ```

2. **Check MBSA Version:**
   - **Description:** Display the current version of MBSA installed.
   - **Command:**
     ```cmd
     mbsacli /v
     ```

   - **Explanation:** 
     - The `/v` option displays the version of MBSA.

#### **7. Example Scenarios**

1. **Example of a Full Scan on the Local Machine and Export to XML:**
   - **Command:**
     ```cmd
     mbsacli /n OS+IIS+SQL+PASSWORD /xmlout > C:\ScanResults\scan_result.xml
     ```

   - **Explanation:** 
     - This command runs a full scan on the local machine, checks OS, IIS, SQL, and password vulnerabilities, and exports the result in XML format.

2. **Example of Scanning Multiple Remote Machines with Results Saved:**
   - **Command:**
     ```cmd
     mbsacli /r C:\ScanTargets\remote_machines.txt /o C:\ScanResults
     ```

   - **Explanation:** 
     - This scans all remote machines listed in the text file `remote_machines.txt` and saves the output to the `ScanResults` directory.

---

### **Usage Notes:**
- **Legacy Tool:** MBSA is no longer maintained or updated by Microsoft. For modern security scanning, it's recommended to use other tools such as Microsoft Defender for Endpoint or third-party vulnerability scanners.
- **Supported Systems:** MBSA was designed for older versions of Windows such as Windows 7, Windows Server 2008, and earlier.
- **Automation:** Scans can be automated by using batch scripts or scheduling scans with the Windows Task Scheduler.

If you're working with a modern system, consider using more up-to-date tools. Let me know if you need more details on other tools!