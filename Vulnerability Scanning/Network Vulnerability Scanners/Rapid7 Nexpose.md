`Rapid7 Nexpose` (now known as `InsightVM` as part of Rapid7's Insight platform) is a comprehensive vulnerability management solution that offers continuous visibility into your network's security posture. Hereâ€™s a guide on how to interact with Nexpose/InsightVM using command-line tools, API calls, and options.

### **Rapid7 Nexpose (InsightVM) Shell Commands and API Options**

#### **1. API Authentication and Access**

1. **Authenticate with API:**
   - **Description:** Obtain an API token or session for authentication.
   - **Command:**
     ```bash
     curl -X POST "https://<nexpose_host>:3780/api/3/session" -d '{"username":"<username>","password":"<password>"}' -H "Content-Type: application/json"
     ```
   - **Example:**
     ```bash
     curl -X POST "https://nexpose.example.com:3780/api/3/session" -d '{"username":"admin","password":"password"}' -H "Content-Type: application/json"
     ```

#### **2. Asset Management**

1. **List Assets:**
   - **Description:** Retrieve a list of assets in the system.
   - **Command:**
     ```bash
     curl -X GET "https://<nexpose_host>:3780/api/3/assets" -H "Authorization: Bearer <api_token>"
     ```
   - **Example:**
     ```bash
     curl -X GET "https://nexpose.example.com:3780/api/3/assets" -H "Authorization: Bearer <your_api_token>"
     ```

2. **Get Details of a Specific Asset:**
   - **Description:** Retrieve detailed information about a specific asset.
   - **Command:**
     ```bash
     curl -X GET "https://<nexpose_host>:3780/api/3/assets/<asset_id>" -H "Authorization: Bearer <api_token>"
     ```
   - **Example:**
     ```bash
     curl -X GET "https://nexpose.example.com:3780/api/3/assets/12345" -H "Authorization: Bearer <your_api_token>"
     ```

#### **3. Scan Management**

1. **List Scans:**
   - **Description:** List all scans.
   - **Command:**
     ```bash
     curl -X GET "https://<nexpose_host>:3780/api/3/scans" -H "Authorization: Bearer <api_token>"
     ```
   - **Example:**
     ```bash
     curl -X GET "https://nexpose.example.com:3780/api/3/scans" -H "Authorization: Bearer <your_api_token>"
     ```

2. **Create a New Scan:**
   - **Description:** Create and configure a new scan.
   - **Command:**
     ```bash
     curl -X POST "https://<nexpose_host>:3780/api/3/scans" -d '{"name":"<scan_name>","site_id":"<site_id>","scan_template_id":"<template_id>","assets":["<asset_id>"]}' -H "Authorization: Bearer <api_token>" -H "Content-Type: application/json"
     ```
   - **Example:**
     ```bash
     curl -X POST "https://nexpose.example.com:3780/api/3/scans" -d '{"name":"New Scan","site_id":"1","scan_template_id":"basic","assets":["12345"]}' -H "Authorization: Bearer <your_api_token>" -H "Content-Type: application/json"
     ```

3. **Start a Scan:**
   - **Description:** Start a specific scan by its ID.
   - **Command:**
     ```bash
     curl -X POST "https://<nexpose_host>:3780/api/3/scans/<scan_id>/launch" -H "Authorization: Bearer <api_token>"
     ```
   - **Example:**
     ```bash
     curl -X POST "https://nexpose.example.com:3780/api/3/scans/12345/launch" -H "Authorization: Bearer <your_api_token>"
     ```

4. **Stop a Scan:**
   - **Description:** Stop a running scan by its ID.
   - **Command:**
     ```bash
     curl -X POST "https://<nexpose_host>:3780/api/3/scans/<scan_id>/cancel" -H "Authorization: Bearer <api_token>"
     ```
   - **Example:**
     ```bash
     curl -X POST "https://nexpose.example.com:3780/api/3/scans/12345/cancel" -H "Authorization: Bearer <your_api_token>"
     ```

5. **Get Scan Status:**
   - **Description:** Retrieve the status of a scan.
   - **Command:**
     ```bash
     curl -X GET "https://<nexpose_host>:3780/api/3/scans/<scan_id>" -H "Authorization: Bearer <api_token>"
     ```
   - **Example:**
     ```bash
     curl -X GET "https://nexpose.example.com:3780/api/3/scans/12345" -H "Authorization: Bearer <your_api_token>"
     ```

6. **Get Scan Report:**
   - **Description:** Retrieve the results of a completed scan.
   - **Command:**
     ```bash
     curl -X GET "https://<nexpose_host>:3780/api/3/scans/<scan_id>/report" -H "Authorization: Bearer <api_token>"
     ```
   - **Example:**
     ```bash
     curl -X GET "https://nexpose.example.com:3780/api/3/scans/12345/report" -H "Authorization: Bearer <your_api_token>"
     ```

#### **4. Site Management**

1. **List Sites:**
   - **Description:** Retrieve a list of all sites.
   - **Command:**
     ```bash
     curl -X GET "https://<nexpose_host>:3780/api/3/sites" -H "Authorization: Bearer <api_token>"
     ```
   - **Example:**
     ```bash
     curl -X GET "https://nexpose.example.com:3780/api/3/sites" -H "Authorization: Bearer <your_api_token>"
     ```

2. **Create a New Site:**
   - **Description:** Create a new site with specified parameters.
   - **Command:**
     ```bash
     curl -X POST "https://<nexpose_host>:3780/api/3/sites" -d '{"name":"<site_name>","description":"<description>","assets":["<asset_id>"]}' -H "Authorization: Bearer <api_token>" -H "Content-Type: application/json"
     ```
   - **Example:**
     ```bash
     curl -X POST "https://nexpose.example.com:3780/api/3/sites" -d '{"name":"New Site","description":"Site for testing","assets":["12345"]}' -H "Authorization: Bearer <your_api_token>" -H "Content-Type: application/json"
     ```

3. **Update Site Information:**
   - **Description:** Update the information for an existing site.
   - **Command:**
     ```bash
     curl -X PUT "https://<nexpose_host>:3780/api/3/sites/<site_id>" -d '{"name":"<new_name>","description":"<new_description>"}' -H "Authorization: Bearer <api_token>" -H "Content-Type: application/json"
     ```
   - **Example:**
     ```bash
     curl -X PUT "https://nexpose.example.com:3780/api/3/sites/12345" -d '{"name":"Updated Site","description":"Updated description"}' -H "Authorization: Bearer <your_api_token>" -H "Content-Type: application/json"
     ```

4. **Delete a Site:**
   - **Description:** Delete a site by its ID.
   - **Command:**
     ```bash
     curl -X DELETE "https://<nexpose_host>:3780/api/3/sites/<site_id>" -H "Authorization: Bearer <api_token>"
     ```
   - **Example:**
     ```bash
     curl -X DELETE "https://nexpose.example.com:3780/api/3/sites/12345" -H "Authorization: Bearer <your_api_token>"
     ```

#### **5. User Management**

1. **List Users:**
   - **Description:** List all users in the system.
   - **Command:**
     ```bash
     curl -X GET "https://<nexpose_host>:3780/api/3/users" -H "Authorization: Bearer <api_token>"
     ```
   - **Example:**
     ```bash
     curl -X GET "https://nexpose.example.com:3780/api/3/users" -H "Authorization: Bearer <your_api_token>"
     ```

2. **Create a New User:**
   - **Description:** Create a new user account.
   - **Command:**
     ```bash
     curl -X POST "https://<nexpose_host>:3780/api/3/users" -d '{"username":"<username>","password":"<password>","email":"<email>"}' -H "Authorization: Bearer <api_token>" -H "Content-Type: application/json"
     ```
   - **Example:**
    

 ```bash
     curl -X POST "https://nexpose.example.com:3780/api/3/users" -d '{"username":"newuser","password":"password","email":"newuser@example.com"}' -H "Authorization: Bearer <your_api_token>" -H "Content-Type: application/json"
     ```

3. **Update User Information:**
   - **Description:** Update the details of an existing user.
   - **Command:**
     ```bash
     curl -X PUT "https://<nexpose_host>:3780/api/3/users/<user_id>" -d '{"email":"<new_email>"}' -H "Authorization: Bearer <api_token>" -H "Content-Type: application/json"
     ```
   - **Example:**
     ```bash
     curl -X PUT "https://nexpose.example.com:3780/api/3/users/12345" -d '{"email":"updatedemail@example.com"}' -H "Authorization: Bearer <your_api_token>" -H "Content-Type: application/json"
     ```

4. **Delete a User:**
   - **Description:** Remove a user from the system.
   - **Command:**
     ```bash
     curl -X DELETE "https://<nexpose_host>:3780/api/3/users/<user_id>" -H "Authorization: Bearer <api_token>"
     ```
   - **Example:**
     ```bash
     curl -X DELETE "https://nexpose.example.com:3780/api/3/users/12345" -H "Authorization: Bearer <your_api_token>"
     ```

### **Usage Notes**

- **Permissions:** Ensure you have appropriate permissions to perform actions like creating, updating, or deleting assets and users.
- **API Limits:** Be aware of API rate limits and usage policies set by your Nexpose/InsightVM instance.
- **Security:** Secure your API token and avoid exposing sensitive information in public scripts or logs.